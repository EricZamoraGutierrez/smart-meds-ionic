{"ast":null,"code":"import _asyncToGenerator from \"c:/Users/benji/OneDrive/Documents/smartmeds project/smart-meds-ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Validators } from '@angular/forms';\nimport { doc, getDoc, updateDoc } from '@angular/fire/firestore';\nimport { getFirestore } from 'firebase/firestore';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ionic/angular\";\nimport * as i2 from \"@angular/forms\";\nimport * as i3 from \"../services/user.service\";\nimport * as i4 from \"@angular/fire/firestore\";\nimport * as i5 from \"@angular/router\";\nlet PerfilPage = /*#__PURE__*/(() => {\n  var _PerfilPage;\n  class PerfilPage {\n    constructor(navCtrl, formBuilder, userService, firestore, router) {\n      this.navCtrl = navCtrl;\n      this.formBuilder = formBuilder;\n      this.userService = userService;\n      this.firestore = firestore;\n      this.router = router;\n      this.imageSource = null;\n      this.formData = []; // Arreglo para almacenar los datos del formulario\n      //userdata\n      this.userData = {\n        name: \"\",\n        email: \"\",\n        lastname: \"\",\n        phone: \"\",\n        password: \"\"\n      };\n      this.ProfilePic = \"\";\n      this.finishedLoading = false;\n      this.myForm = this.formBuilder.group({\n        name: ['', Validators.required],\n        email: ['', [Validators.required]],\n        // password: ['', [Validators.required, Validators.minLength(8), Validators.pattern(/^(?=.[a-z])(?=.[A-Z]).{8,}$/)]],\n        lastname: ['', Validators.required],\n        phone: ['', Validators.required],\n        password: ['', [Validators.required, Validators.minLength(8), Validators.pattern(/^(?=.[a-z])(?=.[A-Z]).{8,}$/)]]\n      });\n    }\n    ngOnInit() {\n      this.getUserData();\n      // this.userID = this.userService.getUser();\n    }\n\n    goBack() {\n      this.navCtrl.back();\n    }\n    displayImage(event) {\n      const input = event.target;\n      if (input.files && input.files[0]) {\n        const reader = new FileReader();\n        reader.onload = () => {\n          if (typeof reader.result === 'string') {\n            this.imageSource = reader.result;\n          }\n        };\n        console.log(input.files[0]);\n        reader.readAsDataURL(input.files[0]);\n        this.userService.saveProfilePic(input.files[0]);\n        this.ProfilePic = input.files[0].name;\n        updateDoc(this.userDoc, {\n          ProfilePic: \"images\" + this.ProfilePic\n        }), error => {\n          console.log(error);\n        };\n      }\n    }\n    submitForm() {\n      if (this.myForm.valid) {\n        this.formData.push(this.myForm.value);\n        // Reiniciar el formulario\n        // this.myForm.reset();\n        console.log('Formulario enviado. Datos guardados:', this.formData);\n        this.updateUserData(this.myForm.value.name, this.myForm.value.phone, this.myForm.value.lastname, this.userDoc, this.userID);\n      }\n    }\n    regresar() {\n      this.router.navigate(['/tabs/tab4']);\n    }\n    cerrar() {\n      this.router.navigate(['/login']);\n    }\n    isFormValid() {\n      return this.myForm.valid;\n    }\n    getUserData() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        const db = getFirestore();\n        const id = yield _this.userService.getUser();\n        // this.userService.getProfilePic(id).then((url) => {\n        //   this.imageSource = url;\n        // });\n        _this.userID = id;\n        console.log(_this.userID);\n        const docref = doc(db, 'Users', id);\n        _this.userDoc = docref;\n        console.log(docref);\n        try {\n          const docSnap = yield getDoc(docref);\n          console.log(docSnap.data());\n          const data = docSnap.data();\n          _this.userData.email = data.email;\n          _this.userData.name = data.name;\n          _this.userData.phone = data.phone;\n          _this.userData.lastname = data.lastname;\n          _this.ProfilePic = data.ProfilePic;\n        } catch (error) {\n          console.log(error);\n        }\n        _this.userService.getProfilePicURL(_this.ProfilePic).then(url => {\n          _this.imageSource = url;\n        });\n        //Usar esta variable para definir cuando quitar la barra de carga\n        _this.finishedLoading = true;\n      })();\n    }\n    updateUserData(name, phone, lastname, dbRef, id) {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        _this2.userService.updateUserData(name, phone, lastname, dbRef, id).then(() => {\n          console.log(\"Datos actualizados\");\n        }).catch(error => {\n          console.log(error);\n        });\n        _this2.getUserData();\n      })();\n    }\n  }\n  _PerfilPage = PerfilPage;\n  _PerfilPage.ɵfac = function PerfilPage_Factory(t) {\n    return new (t || _PerfilPage)(i0.ɵɵdirectiveInject(i1.NavController), i0.ɵɵdirectiveInject(i2.FormBuilder), i0.ɵɵdirectiveInject(i3.UserService), i0.ɵɵdirectiveInject(i4.Firestore), i0.ɵɵdirectiveInject(i5.Router));\n  };\n  _PerfilPage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: _PerfilPage,\n    selectors: [[\"app-perfil\"]],\n    decls: 44,\n    vars: 7,\n    consts: [[\"slot\", \"start\", 3, \"click\"], [\"slot\", \"icon-only\", \"name\", \"chevron-back\", 2, \"font-size\", \"38px\"], [1, \"titulo\"], [\"slot\", \"end\"], [\"slot\", \"icon-only\", \"name\", \"settings\", 2, \"font-size\", \"38px\"], [1, \"ion-justify-content-center\", \"ion-align-items-center\"], [\"size\", \"auto\", 1, \"profile-container\"], [1, \"avatar-wrapper\"], [1, \"profile-avatar\"], [\"src\", \"assets/images/conexioncompartir.png\", \"alt\", \"Profile Image\"], [\"name\", \"create-outline\", 1, \"edit-icon\"], [1, \"profile-name\"], [1, \"form-wrapper\"], [3, \"formGroup\"], [\"type\", \"text\", \"id\", \"name\", \"fill\", \"solid\", \"label\", \"Nombre\", \"labelPlacement\", \"floating\", \"formControlName\", \"name\", 3, \"value\"], [\"type\", \"lastname\", \"id\", \"lastname\", \"fill\", \"solid\", \"label\", \"Apellido(s)\", \"labelPlacement\", \"floating\", \"formControlName\", \"lastname\", 3, \"value\"], [\"type\", \"email\", \"id\", \"email\", \"fill\", \"solid\", \"label\", \"Correo\", \"labelPlacement\", \"floating\", \"formControlName\", \"email\", 3, \"readonly\", \"value\"], [\"type\", \"phone\", \"id\", \"phone\", \"fill\", \"solid\", \"label\", \"Numero\", \"labelPlacement\", \"floating\", \"formControlName\", \"phone\", 3, \"value\"], [\"expand\", \"full\", 3, \"disabled\", \"click\"], [1, \"cerrar\"], [\"lines\", \"none\"], [\"name\", \"lock-open\", \"slot\", \"start\"], [\"name\", \"chevron-forward\", \"slot\", \"end\"], [\"lines\", \"none\", 3, \"click\"], [\"name\", \"exit\", \"slot\", \"start\"]],\n    template: function PerfilPage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-toolbar\")(1, \"ion-buttons\", 0);\n        i0.ɵɵlistener(\"click\", function PerfilPage_Template_ion_buttons_click_1_listener() {\n          return ctx.goBack();\n        });\n        i0.ɵɵelementStart(2, \"ion-button\");\n        i0.ɵɵelement(3, \"ion-icon\", 1);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(4, \"div\", 2)(5, \"h2\");\n        i0.ɵɵtext(6, \"Mi Perfil\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(7, \"ion-buttons\", 3)(8, \"ion-button\");\n        i0.ɵɵelement(9, \"ion-icon\", 4);\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(10, \"ion-content\")(11, \"ion-grid\")(12, \"ion-row\", 5)(13, \"ion-col\", 6)(14, \"div\", 7)(15, \"ion-avatar\", 8);\n        i0.ɵɵelement(16, \"img\", 9);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(17, \"ion-icon\", 10);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(18, \"h2\", 11);\n        i0.ɵɵtext(19, \"Nombre Apellido\");\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(20, \"div\", 12)(21, \"form\", 13)(22, \"ion-item\");\n        i0.ɵɵelement(23, \"ion-input\", 14);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(24, \"ion-item\");\n        i0.ɵɵelement(25, \"ion-input\", 15);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(26, \"ion-item\");\n        i0.ɵɵelement(27, \"ion-input\", 16);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(28, \"ion-item\");\n        i0.ɵɵelement(29, \"ion-input\", 17);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(30, \"ion-button\", 18);\n        i0.ɵɵlistener(\"click\", function PerfilPage_Template_ion_button_click_30_listener() {\n          return ctx.submitForm();\n        });\n        i0.ɵɵtext(31, \"UPDATE\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(32, \"div\", 19)(33, \"ion-list\")(34, \"ion-item\", 20);\n        i0.ɵɵelement(35, \"ion-icon\", 21);\n        i0.ɵɵelementStart(36, \"ion-label\");\n        i0.ɵɵtext(37, \"Pol\\u00EDtica Y Privacidad\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(38, \"ion-icon\", 22);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(39, \"ion-item\", 23);\n        i0.ɵɵlistener(\"click\", function PerfilPage_Template_ion_item_click_39_listener() {\n          return ctx.cerrar();\n        });\n        i0.ɵɵelement(40, \"ion-icon\", 24);\n        i0.ɵɵelementStart(41, \"ion-label\");\n        i0.ɵɵtext(42, \"Cerrar Sesi\\u00F3n\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(43, \"ion-icon\", 22);\n        i0.ɵɵelementEnd()()()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(21);\n        i0.ɵɵproperty(\"formGroup\", ctx.myForm);\n        i0.ɵɵadvance(2);\n        i0.ɵɵpropertyInterpolate(\"value\", ctx.userData.name);\n        i0.ɵɵadvance(2);\n        i0.ɵɵpropertyInterpolate(\"value\", ctx.userData.lastname);\n        i0.ɵɵadvance(2);\n        i0.ɵɵpropertyInterpolate(\"value\", ctx.userData.email);\n        i0.ɵɵproperty(\"readonly\", false);\n        i0.ɵɵadvance(2);\n        i0.ɵɵpropertyInterpolate(\"value\", ctx.userData.phone);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"disabled\", !ctx.isFormValid());\n      }\n    },\n    dependencies: [i1.IonAvatar, i1.IonButton, i1.IonButtons, i1.IonCol, i1.IonContent, i1.IonGrid, i1.IonIcon, i1.IonInput, i1.IonItem, i1.IonLabel, i1.IonList, i1.IonRow, i1.IonToolbar, i1.TextValueAccessor, i2.ɵNgNoValidate, i2.NgControlStatus, i2.NgControlStatusGroup, i2.FormGroupDirective, i2.FormControlName],\n    styles: [\"@charset \\\"UTF-8\\\";ion-buttons[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#0c487a}.profile-container[_ngcontent-%COMP%]{text-align:center}.avatar-wrapper[_ngcontent-%COMP%]{position:relative;display:inline-block}.profile-avatar[_ngcontent-%COMP%]{width:150px;height:150px}.profile-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:50%}.edit-icon[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;background-color:#005fa3;color:#fff;padding:5px;border-radius:50%;font-size:18px;transform:translate(10%,40%)}.profile-name[_ngcontent-%COMP%]{font-size:20px;font-weight:700;color:#000;margin-top:10px}ion-row[_ngcontent-%COMP%]{margin:0 10px}ion-avatar[_ngcontent-%COMP%]{height:150px;width:150px}ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#000}h2[_ngcontent-%COMP%]{text-align:center;color:#0c487a;font-size:28px;margin-top:10px}.perfil[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{height:30px;width:30px}ion-button[_ngcontent-%COMP%]{color:#0c487a;font-size:20px}.titulo[_ngcontent-%COMP%]{text-align:center}ion-toolbar[_ngcontent-%COMP%]{padding:20px}ion-list[_ngcontent-%COMP%]{margin:0 10px 30px}.cerrar[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#0c487a}ion-input[_ngcontent-%COMP%]{font-size:18px}ion-item[_ngcontent-%COMP%]{margin:5px 0 0}.cerrar[_ngcontent-%COMP%]{display:flex;justify-content:center}.cerrar[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{border-color:#0c487a;border-style:solid;border-width:2px;border-radius:30px}\"]\n  });\n  return PerfilPage;\n})();\nexport { PerfilPage };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}