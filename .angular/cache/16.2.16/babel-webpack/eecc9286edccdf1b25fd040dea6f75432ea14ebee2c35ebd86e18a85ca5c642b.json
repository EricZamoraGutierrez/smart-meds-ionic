{"ast":null,"code":"import _asyncToGenerator from \"c:/Users/benji/OneDrive/Documents/smartmeds project/smart-meds-ionic/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Validators } from '@angular/forms';\nimport { doc, getDoc, updateDoc } from '@angular/fire/firestore';\nimport { getFirestore } from 'firebase/firestore';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../services/user.service\";\nimport * as i3 from \"@angular/fire/firestore\";\nimport * as i4 from \"@angular/router\";\nlet PerfilPage = /*#__PURE__*/(() => {\n  var _PerfilPage;\n  class PerfilPage {\n    constructor(formBuilder, userService, firestore, router) {\n      this.formBuilder = formBuilder;\n      this.userService = userService;\n      this.firestore = firestore;\n      this.router = router;\n      this.imageSource = null;\n      this.formData = []; // Arreglo para almacenar los datos del formulario\n      //userdata\n      this.userData = {\n        name: \"\",\n        email: \"\",\n        lastname: \"\",\n        phone: \"\"\n        //lastname\n      };\n\n      this.ProfilePic = \"\";\n      this.finishedLoading = false;\n      this.myForm = this.formBuilder.group({\n        name: ['', Validators.required],\n        email: ['', [Validators.required]],\n        // password: ['', [Validators.required, Validators.minLength(8), Validators.pattern(/^(?=.[a-z])(?=.[A-Z]).{8,}$/)]],\n        lastname: ['', Validators.required],\n        phone: ['', Validators.required]\n      });\n    }\n    ngOnInit() {\n      this.getUserData();\n      // this.userID = this.userService.getUser();\n    }\n\n    displayImage(event) {\n      const input = event.target;\n      if (input.files && input.files[0]) {\n        const reader = new FileReader();\n        reader.onload = () => {\n          if (typeof reader.result === 'string') {\n            this.imageSource = reader.result;\n          }\n        };\n        console.log(input.files[0]);\n        reader.readAsDataURL(input.files[0]);\n        this.userService.saveProfilePic(input.files[0]);\n        this.ProfilePic = input.files[0].name;\n        updateDoc(this.userDoc, {\n          ProfilePic: \"images\" + this.ProfilePic\n        }), error => {\n          console.log(error);\n        };\n      }\n    }\n    submitForm() {\n      if (this.myForm.valid) {\n        this.formData.push(this.myForm.value);\n        // Reiniciar el formulario\n        // this.myForm.reset();\n        console.log('Formulario enviado. Datos guardados:', this.formData);\n        this.updateUserData(this.myForm.value.name, this.myForm.value.phone, this.myForm.value.lastname, this.userDoc, this.userID);\n      }\n    }\n    regresar() {\n      this.router.navigate(['/tabs/tab4']);\n    }\n    isFormValid() {\n      return this.myForm.valid;\n    }\n    getUserData() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        const db = getFirestore();\n        const id = yield _this.userService.getUser();\n        // this.userService.getProfilePic(id).then((url) => {\n        //   this.imageSource = url;\n        // });\n        _this.userID = id;\n        console.log(_this.userID);\n        const docref = doc(db, 'Users', id);\n        _this.userDoc = docref;\n        console.log(docref);\n        try {\n          const docSnap = yield getDoc(docref);\n          console.log(docSnap.data());\n          const data = docSnap.data();\n          _this.userData.email = data.email;\n          _this.userData.name = data.name;\n          _this.userData.phone = data.phone;\n          _this.userData.lastname = data.lastname;\n          _this.ProfilePic = data.ProfilePic;\n        } catch (error) {\n          console.log(error);\n        }\n        _this.userService.getProfilePicURL(_this.ProfilePic).then(url => {\n          _this.imageSource = url;\n        });\n        //Usar esta variable para definir cuando quitar la barra de carga\n        _this.finishedLoading = true;\n      })();\n    }\n    updateUserData(name, phone, lastname, dbRef, id) {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        _this2.userService.updateUserData(name, phone, lastname, dbRef, id).then(() => {\n          console.log(\"Datos actualizados\");\n        }).catch(error => {\n          console.log(error);\n        });\n        _this2.getUserData();\n      })();\n    }\n  }\n  _PerfilPage = PerfilPage;\n  _PerfilPage.ɵfac = function PerfilPage_Factory(t) {\n    return new (t || _PerfilPage)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.UserService), i0.ɵɵdirectiveInject(i3.Firestore), i0.ɵɵdirectiveInject(i4.Router));\n  };\n  _PerfilPage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: _PerfilPage,\n    selectors: [[\"app-perfil\"]],\n    decls: 0,\n    vars: 0,\n    template: function PerfilPage_Template(rf, ctx) {},\n    styles: [\"@charset \\\"UTF-8\\\";.bar[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}h1[_ngcontent-%COMP%]{font-family:Roboto,sans-serif;text-align:center;padding:20px}.content-box[_ngcontent-%COMP%]{width:300px;margin:0 auto;height:450px}.form-wrapper[_ngcontent-%COMP%]{margin-top:20px}form[_ngcontent-%COMP%]{display:flex;flex-direction:column}.custom-file[_ngcontent-%COMP%]{position:relative;text-align:center}.custom-file[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer}.file-label[_ngcontent-%COMP%]{background-color:#6e85b7;color:#fff;padding:8px 12px;border-radius:4px;cursor:pointer;margin-top:10px}.file-text[_ngcontent-%COMP%]{color:#fff;margin-top:5px}.image-preview[_ngcontent-%COMP%]{text-align:center;margin:0 auto;width:150px;height:150px;border-radius:100%;overflow:hidden;display:flex;justify-content:center;align-items:center}.image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:150px;min-height:150px;max-height:150px;border-radius:100%;display:block;margin-top:40px}input[type=submit][_ngcontent-%COMP%]{background-color:#333232;color:#fff;border-radius:5px;padding:8px 16px;border:none;cursor:pointer;margin-top:10px}input[type=submit][_ngcontent-%COMP%]:hover{background-color:#333}.background-box[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:25vh;z-index:-1}.profile-section[_ngcontent-%COMP%]{text-align:center}\"]\n  });\n  return PerfilPage;\n})();\nexport { PerfilPage };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}